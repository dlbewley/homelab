#!/bin/bash
# Download oc clients from mirror

OC_BASE_URL=https://mirror.openshift.com/pub/openshift-v4/clients/
VERSIONS="4.2 4.3 4.4 4.5 4.6 latest nightly"
HELM_VERSIONS="latest"
PLATFORMS="linux macosx" # windows"
INSTALL_DIR="$HOME/bin"

if [ $(uname) == "Darwin" ]; then
    PLATFORMS="macosx"
else
    PLATFORMS="linux"
fi

pushd $INSTALL_DIR > /dev/null
for version in $VERSIONS; do
    for platform in $PLATFORMS; do
        echo "Downloading oc for ${version}/${platform}"
        mkdir -p "oc-${version}/${platform}"
        pushd "oc-${version}/${platform}" > /dev/null
        if [ "$version" == "nightly" ]; then
            plat=$(echo $platform | sed s/osx//) # Darwin platform name is inconsistent on mirror
            curl -s -o oc.tar.gz ${OC_BASE_URL}/ocp-dev-preview/latest/openshift-client-${plat}.tar.gz
        else
            curl -s -O ${OC_BASE_URL}/oc/${version}/${platform}/oc.tar.gz
        fi
        tar xzf oc.tar.gz
        popd > /dev/null
    done
done
popd > /dev/null

pushd $INSTALL_DIR > /dev/null
for version in $HELM_VERSIONS; do
    for platform in $PLATFORMS; do
        if [ "$platform" == "macosx" ]; then
            platform="darwin"
        fi
        echo "Downloading helm for ${version}/${platform}"
        mkdir -p "helm-${version}/${platform}"
        pushd "helm-${version}/${platform}" > /dev/null
        curl -s -O ${OC_BASE_URL}/helm/${version}/helm-${platform}-amd64
        chmod 755 helm-${platform}-amd64
        ln -s helm-${platform}-amd64 helm
        popd > /dev/null
    done
done
popd > /dev/null
